# .github/workflows/main-deploy.yml

name: ‚öôÔ∏è DEDALUS - Deploy Centralizado (BACKEND & FRONTEND)

# Gatilho: Roda quando h√° um push para a branch 'main'
on:
  push:
    branches:
      - main
    paths-ignore: # Opcional: Ignora arquivos de documenta√ß√£o, etc.
      - '**.md'
      - '.gitignore'

jobs:
  # -----------------------------------------------------
  # 1. Job do Backend: Build e Deploy do Motor de Orquestra√ß√£o
  # -----------------------------------------------------
  deploy-backend:
    runs-on: ubuntu-latest
    name: Build & Deploy Backend
    # Executa este job SOMENTE se houver mudan√ßas no diret√≥rio do backend
    if: |
      contains(github.event.commits.*.modified, 'backend/orchestration-engine/') ||
      contains(github.event.commits.*.added, 'backend/orchestration-engine/')
    
    steps:
    - name: ‚¨áÔ∏è Checkout do C√≥digo
      uses: actions/checkout@v4
      
    - name: üõ†Ô∏è Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: ‚öôÔ∏è Instalar e Buildar Backend
      run: |
        cd backend/orchestration-engine
        npm install
        npm run build
        
    - name: üì¶ Compactar Arquivos para Deployment
      uses: actions/upload-artifact@v4
      with:
        name: backend-dist
        path: backend/orchestration-engine/dist
        
    # --- DEPLOYMENT ---
    # Nota: A A√ß√£o de FTP/SFTP ser√° adicionada aqui, usando GitHub Secrets.
    # Exemplo (Requer a configura√ß√£o pr√©via dos Secrets):
    # - name: üöÄ Deploy Backend (FTP/SFTP)
    #   uses: SamKirkland/FTP-Deploy-Action@v4.3.0
    #   with:
    #     server: ${{ secrets.FTP_SERVER }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ secrets.FTP_PASSWORD }}
    #     local-dir: ./backend/orchestration-engine/dist/
    #     server-dir: /home/user/dedalus-backend/
      
  # -----------------------------------------------------
  # 2. Job do Frontend: Build e Deploy do Designer Low-Code
  # -----------------------------------------------------
  deploy-frontend:
    runs-on: ubuntu-latest
    name: Build & Deploy Frontend
    # Executa este job SOMENTE se houver mudan√ßas no diret√≥rio do frontend
    if: |
      contains(github.event.commits.*.modified, 'frontend/designer-ui/') ||
      contains(github.event.commits.*.added, 'frontend/designer-ui/')
      
    steps:
    - name: ‚¨áÔ∏è Checkout do C√≥digo
      uses: actions/checkout@v4
      
    - name: üõ†Ô∏è Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: üé® Instalar e Buildar Frontend
      run: |
        cd frontend/designer-ui
        npm install
        npm run build
        
    # --- DEPLOYMENT ---
    # - name: üöÄ Deploy Frontend (FTP/SFTP)
    #   uses: SamKirkland/FTP-Deploy-Action@v4.3.0
    #   with:
    #     server: ${{ secrets.FTP_SERVER }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ secrets.FTP_PASSWORD }}
    #     local-dir: ./frontend/designer-ui/build/
    #     server-dir: /public_html/
