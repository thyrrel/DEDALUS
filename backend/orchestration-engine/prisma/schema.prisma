// /backend/orchestration-engine/prisma/schema.prisma (FINAL E CORRIGIDO PARA PRISMA 7+)

// Define o conector e o provedor do banco de dados
generator client {
  provider = "prisma-client-js"
}

// ATENÇÃO: A PROPRIEDADE 'url' FOI REMOVIDA AQUI CONFORME ERRO P1012.
// A configuração da URL será migrada para o 'PrismaClient.ts' (passada via código).
datasource db {
  provider = "mysql"
  // Removida: url = env("DATABASE_URL")
}

// --- MODELOS DE DADOS DEDALUS (MANTIDOS) ---

// 1. Modelo de Workflow (Definição do fluxo Low-Code)
model Workflow {
  id          String   @id @default(uuid()) @db.VarChar(36)
  name        String   @db.VarChar(255)
  version     Int      @default(1)
  description String?  @db.Text
  authorId    String   @db.VarChar(100)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  nodesJson   Json     @map("nodes_json") 

  executions  WorkflowExecution[]
  
  @@unique([name, version])
  @@map("workflows")
}

// 2. Modelo de Execução de Workflow (Histórico e Estado)
model WorkflowExecution {
  instanceId      String   @id @default(uuid()) @db.VarChar(36)
  workflowId      String   @db.VarChar(36)
  status          String   @db.VarChar(50)
  currentNodeId   String   @map("current_node_id") @db.VarChar(50)
  dataContextJson Json     @map("data_context_json")
  startTime       DateTime @default(now())
  endTime         DateTime?
  historyJson     Json     @map("history_json")

  workflow Workflow @relation(fields: [workflowId], references: [id])
  
  @@map("workflow_executions")
}
